# Tariff (домен)

Этот домен отвечает за определение тарифных планов и их параметров.

## Агрегаты

### Tariff

*Тарифный план с его параметрами и ценами.*

**Содержит:**
- `id` Уникальный идентификатор тарифа
- `name` Название тарифа
- `description` Описание тарифа
- `status` Статус тарифа (`Active`, `Archived`)
- `billingCycle` Тип списания (`Hourly`, `Monthly`, `OneTime`)
- `isExtendable` Поддерживает ли продление (для OneTime тарифов)
- `createdAt` Дата создания тарифа
- `updatedAt` Дата последнего обновления
- `archivedAt` Дата архивации (если применимо)
- `prices` Список цен в разных валютах
- `quotas` Список лимитов ресурсов
- `version` Версия тарифа

## События

### TariffCreated
*Создан новый тариф*

**Когда происходит:**
- После успешного создания тарифа администратором

**Данные события:**
- `tariffID` Идентификатор тарифа
- `name` Название тарифа
- `description` Описание тарифа
- `billingCycle` Тип списания
- `prices` Цены в различных валютах
- `quotas` Лимиты ресурсов
- `createdAt` Время создания

**Используется для:**
- Отправки уведомления о новом тарифе пользователям
- Интеграции с системой документации
- Обновления каталога тарифов
- Создания записей в истории тарифов

### TariffUpdated
*Тариф обновлен*

**Когда происходит:**
- После успешного обновления параметров тарифа

**Данные события:**
- `tariffID` Идентификатор тарифа
- `oldVersion` Предыдущая версия тарифа
- `newVersion` Новая версия тарифа
- `changedFields` Измененные поля
- `updatedAt` Время обновления
- `requiresNotification` Требуется ли уведомление пользователей

**Используется для:**
- Создания новой версии тарифа
- Отправки уведомления существующим подписчикам
- Обновления документации
- Аудита изменений тарифов

### TariffArchived
*Тариф архивирован*

**Когда происходит:**
- После успешного архивирования тарифа администратором

**Данные события:**
- `tariffID` Идентификатор тарифа
- `archivedAt` Время архивации
- `reason` Причина архивации
- `deprecationDate` Дата окончания поддержки
- `activeSubscriptionsCount` Количество активных подписок

**Используется для:**
- Отправки уведомления пользователям с активными подписками
- Блокировки возможности создания новых подписок
- Планирования миграции существующих подписчиков
- Аналитики причин архивации тарифов

### PriceAdded
*Добавлена цена в новой валюте*

**Когда происходит:**
- После добавления цены в новой валюте к существующему тарифу

**Данные события:**
- `tariffID` Идентификатор тарифа
- `currency` Добавленная валюта
- `amount` Сумма
- `isDefault` Сделана ли валютой по умолчанию
- `addedAt` Время добавления

**Используется для:**
- Обновления отображения тарифа для пользователей в новой валюте
- Расчета конвертации для существующих подписчиков
- Отправки уведомления о поддержке новой валюты
- Аналитики популярности валют

### PriceRemoved
*Удалена цена в валюте*

**Когда происходит:**
- После удаления цены в определенной валюте из тарифа

**Данные события:**
- `tariffID` Идентификатор тарифа
- `currency` Удаленная валюта
- `wasDefault` Была ли валютой по умолчанию
- `newDefaultCurrency` Новая валюта по умолчанию
- `removedAt` Время удаления

**Используется для:**
- Обновления отображения тарифа
- Отправки уведомления пользователям об изменении валют
- Пересчета цен для существующих подписчиков
- Проверки влияния на активные подписки

## Репозитории

### ITariffRepository

#### Create(tariff *Tariff) (TariffID, error)
Создает новый тариф в системе.

**Входные параметры:**
- `tariff` Указатель на агрегат Tariff

**Выходные параметры:**
- `TariffID` Идентификатор созданного тарифа
- `error` Ошибка создания (например, TariffNameExistsError)

#### GetByID(tariffID string) (*Tariff, error)
Получает тариф по идентификатору.

**Входные параметры:**
- `tariffID` Идентификатор тарифа

**Выходные параметры:**
- `*Tariff` Указатель на агрегат Tariff
- `error` Ошибка получения (например, TariffNotFoundError)

#### GetActiveTariffs() ([]Tariff, error)
Получает список активных тарифов.

**Входные параметры:**
- отсутствуют

**Выходные параметры:**
- `[]Tariff` Список активных тарифов
- `error` Ошибка запроса

#### GetTariffs(filter TariffFilter, page int, pageSize int) ([]Tariff, int, error)
Получает список тарифов с фильтрацией и пагинацией.

**Входные параметры:**
- `filter` Фильтр для поиска тарифов
- `page` Номер страницы
- `pageSize` Размер страницы

**Выходные параметры:**
- `[]Tariff` Список тарифов
- `int` Общее количество записей
- `error` Ошибка запроса

#### Update(tariff *Tariff) error
Обновляет данные тарифа.

**Входные параметры:**
- `tariff` Указатель на агрегат Tariff с обновленными данными

**Выходные параметры:**
- `error` Ошибка обновления (например, ActiveSubscriptionsConflictError)

#### Archive(tariffID TariffID, archivedAt time.Time) error
Помечает тариф как архивный.

**Входные параметры:**
- `tariffID` Идентификатор тарифа
- `archivedAt` Дата архивации

**Выходные параметры:**
- `error` Ошибка архивации (например, ActiveSubscriptionsError)

#### HasActiveSubscriptions(tariffID TariffID) (bool, error)
Проверяет наличие активных подписок на тариф.

**Входные параметры:**
- `tariffID` Идентификатор тарифа

**Выходные параметры:**
- `bool` true, если есть активные подписки
- `error` Ошибка проверки

#### GetPriceByCurrency(tariffID TariffID, currency string) (*Price, error)
Получает цену тарифа в указанной валюте.

**Входные параметры:**
- `tariffID` Идентификатор тарифа
- `currency` Код валюты

**Выходные параметры:**
- `*Price` Указатель на Value Object Price
- `error` Ошибка получения (например, CurrencyNotSupportedError)
