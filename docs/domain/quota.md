# Quota (домен)

Этот домен отвечает за контроль использования ресурсов и лимитов.

## События

### QuotaUsageUpdated
*Обновлено использование квоты*

**Когда происходит:**
- При увеличении использования квоты после операции
- При ручном корректировании квот администратором

**Данные события:**
- `organizationID` Идентификатор организации
- `subscriptionID` Идентификатор подписки
- `resourceType` Тип ресурса
- `oldUsage` Предыдущее использование
- `newUsage` Новое использование
- `increment` Значение увеличения
- `updateTime` Время обновления

**Используется для:**
- Проверки достижения пороговых значений
- Обновления отображения квот в интерфейсе
- Логирования использования ресурсов
- Генерации предупреждений при приближении к лимиту

### QuotaThresholdReached
*Достигнут порог использования квоты*

**Когда происходит:**
- При достижении использования квоты определенного порога (например, 80%)

**Данные события:**
- `organizationID` Идентификатор организации
- `subscriptionID` Идентификатор подписки
- `resourceType` Тип ресурса
- `currentUsage` Текущее использование
- `limit` Общий лимит
- `thresholdPercentage` Достигнутый процент
- `reachedTime` Время достижения порога

**Используется для:**
- Отправки уведомления пользователю о приближении к лимиту
- Предложения обновления тарифа
- Анализа пикового использования ресурсов
- Прогнозирования будущего использования

### QuotaExceeded
*Превышен лимит квоты*

**Когда происходит:**
- При попытке использования ресурса после достижения лимита квоты

**Данные события:**
- `organizationID` Идентификатор организации
- `subscriptionID` Идентификатор подписки
- `resourceType` Тип ресурса
- `currentUsage` Текущее использование
- `limit` Общий лимит
- `attemptedIncrement` Попытка увеличения
- `exceededTime` Время превышения

**Используется для:**
- Блокировки дальнейшего использования ресурса
- Отправки срочного уведомления пользователю
- Предложения немедленного обновления тарифа
- Анализа проблемных точек использования ресурсов

### QuotaReset
*Квота сброшена к начальному значению*

**Когда происходит:**
- При начале нового расчетного периода для периодических квот
- При активации новой подписки

**Данные события:**
- `organizationID` Идентификатор организации
- `subscriptionID` Идентификатор подписки
- `resourceType` Тип ресурса
- `oldUsage` Предыдущее использование
- `resetTime` Время сброса
- `nextResetTime` Следующее время сброса

**Используется для:**
- Обновления отображения квот в интерфейсе
- Отправки уведомления о сбросе квот
- Логирования циклов использования
- Анализа потребления ресурсов в каждом периоде

## Репозитории

### IQuotaRepository

#### GetQuotaUsage(organizationID string, resourceType string) (*QuotaUsage, error)
Получает текущее использование квоты для организации.

**Входные параметры:**
- `organizationID` Идентификатор организации
- `resourceType` Тип ресурса

**Выходные параметры:**
- `*QuotaUsage` Указатель на Value Object QuotaUsage
- `error` Ошибка получения (например, ResourceTypeNotSupportedError)

#### GetQuotaUsages(organizationID string, filter QuotaUsageFilter) ([]QuotaUsage, error)
Получает список использования квот с фильтрацией.

**Входные параметры:**
- `organizationID` Идентификатор организации
- `filter` Фильтр для выборки квот

**Выходные параметры:**
- `[]QuotaUsage` Список использования квот
- `error` Ошибка запроса

#### GetQuotaDefinition(tariffID string, resourceType string) (*QuotaDefinition, error)
Получает определение квоты для тарифа.

**Входные параметры:**
- `tariffID` Идентификатор тарифа
- `resourceType` Тип ресурса

**Выходные параметры:**
- `*QuotaDefinition` Указатель на Value Object QuotaDefinition
- `error` Ошибка получения (например, QuotaNotDefinedError)

#### IncrementUsage(organizationID string, resourceType string, increment int) (*QuotaUsage, error)
Увеличивает использование квоты на указанное значение.

**Входные параметры:**
- `organizationID` Идентификатор организации
- `resourceType` Тип ресурса
- `increment` Значение для увеличения

**Выходные параметры:**
- `*QuotaUsage` Обновленное значение использования квоты
- `error` Ошибка обновления (например, QuotaExceededError)

#### ResetUsage(organizationID string, resourceType string) (*QuotaUsage, error)
Сбрасывает использование квоты к начальному значению.

**Входные параметры:**
- `organizationID` Идентификатор организации
- `resourceType` Тип ресурса

**Выходные параметры:**
- `*QuotaUsage` Сброшенное значение использования квоты
- `error` Ошибка сброса (например, ResourceTypeNotSupportedError)

#### GetSubscriptionsWithQuotaExceeded(resourceType string, threshold float64) ([]string, error)
Получает список подписок, превысивших указанный порог использования квоты.

**Входные параметры:**
- `resourceType` Тип ресурса
- `threshold` Пороговое значение в процентах (0-100)

**Выходные параметры:**
- `[]string` Список идентификаторов подписок
- `error` Ошибка запроса
